(function(c,q){var m="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";c.fn.imagesLoaded=function(f){function n(){var b=c(j),a=c(h);d&&(h.length?d.reject(e,b,a):d.resolve(e));c.isFunction(f)&&f.call(g,e,b,a)}function p(b){k(b.target,"error"===b.type)}function k(b,a){b.src===m||-1!==c.inArray(b,l)||(l.push(b),a?h.push(b):j.push(b),c.data(b,"imagesLoaded",{isBroken:a,src:b.src}),r&&d.notifyWith(c(b),[a,e,c(j),c(h)]),e.length===l.length&&(setTimeout(n),e.unbind(".imagesLoaded",
p)))}var g=this,d=c.isFunction(c.Deferred)?c.Deferred():0,r=c.isFunction(d.notify),e=g.find("img").add(g.filter("img")),l=[],j=[],h=[];c.isPlainObject(f)&&c.each(f,function(b,a){if("callback"===b)f=a;else if(d)d[b](a)});e.length?e.bind("load.imagesLoaded error.imagesLoaded",p).each(function(b,a){var d=a.src,e=c.data(a,"imagesLoaded");if(e&&e.src===d)k(a,e.isBroken);else if(a.complete&&a.naturalWidth!==q)k(a,0===a.naturalWidth||0===a.naturalHeight);else if(a.readyState||a.complete)a.src=m,a.src=d}):
n();return d?d.promise(g):g}})(jQuery);
;
Sage.ApacheSolr = Sage.ApacheSolr || {};

(function ($) {

    Sage.ApacheSolr.ThemeBookModule = (function () {
    /**
     * Private variable toohold the data of a book for rendering
     * @type {{}}
     * @private
     */
    _data = {};
    impressions = [];
    var clickObj = {};
    var impressionsObj = {};
    var i = 1;

    /**
     * @returns {string}
     */
    function image() {
      return _data.bestseller ? '<div class="bestseller">' + _data.image + '</div>' : _data.image;
    }

    /**
     * To check if it is a vantage product.
     *
     * @returns {string}
     */
    function isVantage() {
        return _data.vantage;
    }
    /**
     * @returns {string}
     */
    function title() {
      var output = isVantage() ? '<div class="paragraph-spacing text-small margin-top">' : '<div class="paragraph-spacing text-small">';
      output += '<a href="' + _data.path + '" class="color-smooth-grey strong anchor-camouflaged">' + _data.title + '</a>';
      if (_data.subtitle) {
        output += '<div class="color-warm-grey">' + _data.subtitle + '</div>';
      }
      output += '</div>';
      return output;
    }

    /**
     * @returns {string}
     */
    function description() {
      return _data.description ? '<p>' + _data.description + ' ...</p>' : '';
    }

    /**
     * @returns {string}
     */
    function classificationBanner() {
      var output = '';
      if (_data.classification_group) {
        output += '<div class="text-uppercase border-bottom border--thin inherit-brand-border text-small clearfix margin-bottom">';
        output += '<div class="inherit-brand-fill l-element-left margin-right--small margin-bottom--small">' + _data.classification_icon + '</div>';
        output += _data.classification_group;
        output += '</div>';
      }
      return output;
    }

    /**
     * @returns {string}
     */
    function authors() {
      var output = '';
      if (_data.contributors) {
        output += '<div class="text-small strong">';
        output += _data.contributors.map(function (contributor) {
          return '<a href="' + contributor.path + '" class="anchor-camouflaged">' + contributor.name + '</a>';
        })
          .join(', ');
        output += '</div>';
      }
      return output;
    }

    /**
     * @returns {string}
     */
    function publicationDate() {
      if (!_data.publication_date) {
        return ''
      }
      var output = '';
      output += '<div class="text-small product-date-publication-dates margin-bottom">';
      output += Drupal.t('Published') + ': ' + _data.publication_date;
      output += '</div>';
      return output;
    }

    /**
     * @returns {string}
     */
    function purchaseOptions() {
      var output = '';
      output += '<div class="text-tiny purchase-options-block margin-bottom--small">';
      output += _data.purchase_options;
      output += '</div>';
      return output;
    }

    function extraLinks() {
      var output = '';
      if (_data.is_review_available) {
        output += '<div class="text-small">';
        output += '<a href="' + _data.path + '" class="brand-color-1">' + Drupal.t('Review copy available') + '</a>';
        output += '</div>';
      }
      if (_data.companion_links) {
        output += '<div class="text-small">';
        output += _data.companion_links.map(function (companion_link) {
          return '<div>' + companion_link + '</div>';
        }).join(' ');
        output += '</div>';
      }
      return output;
    }

    return {

      init: function () {
        var containers = document.querySelectorAll("[render-nodes-container]");
        if (containers.length) {
          containers = Array.apply(null, containers);
          containers.map(function (container) {
            return this.renderContainer(container, 'resultsAsGrid');
          }.bind(this));
          Drupal.attachBehaviors(containers, Drupal.settings);
        }

        $("#search-result a").on('click', function (e) {
          var click = [];
          click = JSON.parse($(this).parents("#search-result").attr("datalayer-info"));
          clickObj = {"click": click };
          dataLayer.push({
              event: 'eec.productClick',
              ecommerce: clickObj
          });
        });
      },

      /**
       *
       * @param container
       * @param style
       */
      renderContainer: function (container, style) {
          var _nodes = container.querySelectorAll('[search-result-id]');
          _nodes = Array.apply(null, _nodes);
          this[style](_nodes).map(function (node) {
              if (node.nodeType) {
                  container.appendChild(node);
              }
          });

      },

      /**
       *
       * @param node
       * @param style
       * @returns {*}
       */
      renderNode: function (node, style) {
        node.innerHTML = this[style](JSON.parse(node.getAttribute('node-info')));
        return node;
      },

      /**
       * Function for theming search results into grid pattern.
       *
       * @param items
       * @returns {*|string}
       */
      resultsAsGrid: function (items) {
        items = items.map(function (node) {
         return this.renderNode(node, 'themeGridItem');
        }.bind(this));

        var chunks = items.chunk(4);
        chunks =  chunks.map(function (chunk) {
         var row = document.createElement("div");
          row.className = 'row row-spacing--l';
          for (var i in chunk) {
            row.appendChild(chunk[i]);
          }
          return row;
        });

        return chunks;
      },

        resultsWithoutSwitcher: function (items) {
            items = items.map(function (node) {
                return this.renderNode(node, 'themeGridItem');
            }.bind(this));

            var chunks = items.chunk(4);
            return chunks;
        },

      /**
       * Function for theming search results into list pattern.
       *
       * @param items
       * @returns {*|string}
       */
      resultsAsList: function (items) {
        return items.map(function (node) {
          return this.renderNode(node, 'themeListItem');
        }.bind(this));
      },

      /**
       * Search result (grid) theme
       * @param {object} data
       * @returns {string}
       */
      themeGridItem: function (data) {
        _data = data;
        var output = '';

        output += '<article class="col-sm-6 col-md-3 col-spacing--l margin-bottom--large brand-parent--' + data.brand_parent + '">';
        output += isVantage() ? '<div class="cover-wrapper cover-vantage padding-bottom text-center">' + image() + '</div>'
            : '<div class="product-wrapper"><div class="cover-wrapper padding-bottom text-center">' + image() + '</div></div>';
        output += classificationBanner();
        output += title();
        output += authors();
        output += publicationDate();
        output += purchaseOptions();
        output += extraLinks();

        output += '</article>';
        return output;
      },

      /**
       * Search result (grid) theme
       * @param {object} data
       * @returns {string}
       */
      themeListItem: function (data) {
        _data = data;
        var output = '';
        output += '<article id="search-result" class="margin-bottom--extra-large brand-parent--' + data.brand_parent + '">';
        output += '<div class="media">';
        output += '<div class="media-master">';
        output += '<div class="text-center">' + image() + '</div>';
        output += classificationBanner();
        output += '</div>';
        output += '<div class="media-body">';
        output += title();
        output += authors();
        output += publicationDate();
        output += description();
        output += purchaseOptions();
        output += extraLinks();
        output += '</div>';
        output += '</div>';
        output += '</article>';
        return output;
      }
    };
  }());

    // Pushing data layer.
    jQuery(window).bind('load', function () {
        if (dataLayer) {
          impressionsObj = {"impressions": impressions};
            if (impressions.length > 0) {
                dataLayer.push(
                    {
                        event: 'eec.impressionView',
                        ecommerce: impressionsObj
                    });
            }
        }
  });

})(jQuery);



;
/**
 * @file
 *  Custom breadcrumbs functionality for SAGE.
 */
Sage.Breadcrumbs = Sage.Breadcrumbs || {};

(function ($) {

  Sage.Breadcrumbs = {

    Container: $('.breadcrumb-js'),

    render: function () {
      if (localStorage.getItem('breadcrumbs') !== null) {
        this.resetBreadcrumbs();
        this.addBreadcrumb(['/', 'Home']);
        this.setBreadcrumbs();
        this.resetStorageAfterLeave();
      }
    },

    addBreadcrumb: function (item) {
      Sage.Breadcrumbs.Container.append('<a href="' + item[0] + '" class="search-breadcrumb">' + item[1] + '</a>');
    },

    resetBreadcrumbs: function () {
      Sage.Breadcrumbs.Container.html('');
    },

    addBreadcrumbItem: function (url, title) {
      console.log('Adding URL ' + url + ' with TITLE ' + title);
      url = url.toLowerCase(0);

      if (localStorage.getItem('breadcrumbs') !== null) {
        if (localStorage.getItem('breadcrumbs').split('|').length >= 2) {
          this.removeLastItem();
        }
      }

      if (this.checkIfExist(url) === false) {
        localStorage.breadcrumbs = (localStorage.getItem('breadcrumbs') ? localStorage.getItem('breadcrumbs') + '|' : '') + url + ':' + title;
      }
    },

    checkIfExist: function (path_alias) {
      var exists = false;
      if (localStorage.getItem('breadcrumbs') !== null) {
        var breadcrumbs = localStorage.getItem('breadcrumbs');
        var list = breadcrumbs.split('|');
        $.each(list, function (index, value) {
          url = value.split(':');
          if (url[0] == path_alias) {
            exists = true;
          }
        });
      }
      return exists;
    },

    setBreadcrumbs: function () {
      limit = 2;
      breadcrumbs = localStorage['breadcrumbs'];
      list = breadcrumbs.split('|');

      current_path = window.location.pathname;
      path_elements = current_path.split('/');
      path_alias = '/' + path_elements[path_elements.length - 1];

      if (list.length > 0) {
        var count = 0;
        $.each(list, function (index, value) {
          url = value.split(':');
          if ((url[0].toLowerCase() !== path_alias.toLowerCase()) && count < limit) {
            Sage.Breadcrumbs.Container.append(' > ');
            Sage.Breadcrumbs.Container.append('<a href="' + url[0] + '" class="search-breadcrumb">' + url[1] + '</a>');
          }
          count++;
        });
      }
    },

    addBreadcrumbs: function (items) {
      $.each(items, function (index, value) {
        Sage.Breadcrumbs.Container.append('<a href="' + value[0] + '" class="search-breadcrumb">' + value[1] + '</a>');
        Sage.Breadcrumbs.Container.append(' > ');
      });
    },

    removeLastItem: function() {
      breadcrumbs = localStorage['breadcrumbs'].split('|');
      new_breadcrumbs = '';
      for (i = 0; i < breadcrumbs.length - 1; i++) {
        new_breadcrumbs += breadcrumbs[i];
      }
      localStorage.setItem('breadcrumbs', new_breadcrumbs);
    },

    removeBreadcrumbs: function() {
      localStorage.removeItem('breadcrumbs');
    },

    resetStorageAfterLeave: function () {
      $(window).bind("beforeunload", function () {
        this.removeBreadcrumbs();
      });
    },

    setSearchBreadcrumbs: function () {
      // Check if localStorage present. If yes proceed.
      if (localStorage.getItem('breadcrumbs') !== null) {
        this.resetBreadcrumbs();
        this.addBreadcrumb(['/', 'Home']);
        // Middle part!
        this.setBreadcrumbs();
        // Middle part!
        Sage.Breadcrumbs.Container.append(' > ');
        this.addBreadcrumb(['/product', 'Search']);
        this.resetStorageAfterLeave();
      }
    }

  };

})(jQuery);;
