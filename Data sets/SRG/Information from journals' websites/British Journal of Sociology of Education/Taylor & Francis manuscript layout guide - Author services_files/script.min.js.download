'use strict';jQuery(document).ready(function($){function JOURNFIND(){console.log('JOURNFIND 1.0.90');this.init();this.abstract='';this.journal_click='';this.instance='';this.journal_ids=[];this.journal_oas=[];this.journal_json=[];this.sendFeedback();this.url='https://authorservices.taylorandfrancis.com'}JOURNFIND.prototype.getUrlVars=function(){var self=this;var vars={};var parts=window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(m,key,value){vars[key]=value});return vars};JOURNFIND.prototype.passthroughUrlParameters=function(){var self=this;var url_vars=self.getUrlVars();var url_vars_as_string='';var loop_count=0;for(var key in url_vars){if(loop_count==0){url_vars_as_string+='?'+key+'='+url_vars[key]}else{url_vars_as_string+='&'+key+'='+url_vars[key]}loop_count++}return url_vars_as_string};JOURNFIND.prototype.sendFeedback=function(){var self=this;$(document).on('submit','.journalfinder__feedback .fsForm',function(e){e.preventDefault();console.log('hijacking request for journalfinder..');self.recordInteraction(false,self.rndStr(20),encodeURIComponent(JSON.stringify(self.journal_json)),encodeURIComponent($(this).serialize()));$('.journalfinder__feedback').remove();$('.journalfinder__feedback--trigger').remove()})};JOURNFIND.prototype.init=function(){var self=this;$('.journalfinder__search').click(function(e){e.preventDefault();setTimeout(function(){document.getElementById('journalfinder__feed').scrollIntoView({behavior:'smooth'})},2000);console.log($('.journalfinder__abstract').val());self.journal_json=null;console.log('self.jounral_json',self.journal_json);self.getLocal(self.stripHTML($('.journalfinder__abstract').val()))});$('.journalfinder__feedback--trigger a').click(function(e){e.preventDefault();$('.journalfinder__feedback').toggle()});$(document).on('click','.journalfinder__item--button',function(e){e.preventDefault();var source=$(this).attr('href');source+=self.passthroughUrlParameters();$(this).attr('href',source);var click_id=$(this).parents('.journalfinder__item--container').attr('data-result');self.recordInteraction(click_id,self.rndStr(20),encodeURIComponent(JSON.stringify(self.journal_json)),null);var win=window.open(source,'_blank');win.focus()})};JOURNFIND.prototype.recordInteraction=function(click,id,apijson,comments){var self=this;console.log('recordInteration');console.log(apijson);$.ajax({type:'POST',data:{abstract:encodeURIComponent($('.journalfinder__abstract').val()),click:click,ID:id,JSON:apijson,comment:comments},dataType:'json',url:self.url+'/wp-content/themes/JTF-child/journal_finder_record_ajax.php',success:function success(html){console.log(html);console.log('feedback logged')}})};JOURNFIND.prototype.getLocal=function(abstract){var self=this;$.ajax({type:'GET',dataType:'HTML',url:self.url+'/wp-content/themes/JTF-child/journal_finder_ajax.php?abstract='+abstract,success:function success(html){var json=JSON.parse(html);console.log(json);self.journal_ids=[];self.journal_json=json;var recommendations=json.recommendations;$('.journalfinder__feed--articles').html('');for(var x=0;x<recommendations.length;x++){self.journal_ids.push(recommendations[x]['id']);if(x==recommendations.length-1){console.log(self.journal_ids);self.getJournals(self.journal_ids)}}self.recordInteraction('false',self.rndStr(20),encodeURIComponent(JSON.stringify(self.journal_json)),null)}})};JOURNFIND.prototype.stripHTML=function(html){var temporalDivElement=document.createElement('div');temporalDivElement.innerHTML=html;var temp=temporalDivElement.textContent.replace(/(<([^>]+)>)/ig,'')||temporalDivElement.innerText.replace(/(<([^>]+)>)/ig,'')||'';return temp};JOURNFIND.prototype.rndStr=function(length){var result='';var characters='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';var charactersLength=characters.length;for(var i=0;i<length;i++){result+=characters.charAt(Math.floor(Math.random()*charactersLength))}return result};JOURNFIND.prototype.getJournals=function(journals){var self=this;$.ajax({type:'GET',dataType:'html',url:'https://ayepeaeye.wpengine.com/wp-content/plugins/j_api/read.php?journals='+self.journal_ids+'&fields=all',beforeSend:function beforeSend(){},success:function success(data){var json=JSON.parse(data);console.log(json);$('.journalfinder__feed--articles').html('');for(var x=0;x<json.length;x++){var this_journal=json[x];var rnd=self.rndStr(7);var outer_container=$('<div/>',{id:'journalfinder_'+rnd,class:'journalfinder__item--container col-12 col-lg-6','data-acro':this_journal.acronym,'data-result':x+1});var inner_container=$('<div/>',{id:'journalfinder_'+rnd,class:'journalfinder__item--inner row'});var image=$('<img/>',{id:'journalfinder_'+rnd,class:'journalfinder__item-image col-12 col-lg-4',src:'https://images.tandf.co.uk/common/jcovers/expressionengine/'+this_journal.acronym+'.jpg'});var oa=$('<div/>',{id:'journalfinder_'+rnd,class:'journalfinder__item--oa'});var title=$('<a/>',{id:'journalfinder_'+rnd,class:'journalfinder__item--title journalfinder__item--button',href:this_journal.tfo_url.data});var copy=$('<p/>',{id:'journalfinder_'+rnd,class:'journalfinder__item--copy col-12 col-lg-8'});var button=$('<a/>',{id:'journalfinder_'+rnd,class:'journalfinder__item--button btn btn-default',href:this_journal.tfo_url.data});title.html(this_journal.title.data);var strip_html=self.stripHTML(this_journal.aims_and_scope.data);var truncate=strip_html.substring(0,200);if(this_journal.open_access.data=='OPEN_ALL'){oa.text('Fully OA').addClass('journalfinder__oa--full')}else if(this_journal.open_access.data=='OPEN_SELECT'){oa.text('Offers OA').addClass('journalfinder__oa--offer')}else{oa.remove()}copy.html(truncate+'...');button.text('Read More');inner_container.append(oa);inner_container.append(image);copy.prepend(title);inner_container.append(copy);outer_container.append(inner_container);outer_container.append(button);$('.journalfinder__feed--articles').append(outer_container);$('.journalfinder__item-image').each(function(){$(this).css({height:$(this).width()*1.5})})}}})};if($('.journalfinder').length>0){var api=new JOURNFIND}});function detectIE(){var detectUserAgent=window.navigator.detectUserAgent;var userAgentMsie=detectUserAgent.indexOf('MSIE ');if(userAgentMsie>0){return parseInt(detectUserAgent.substring(userAgentMsie+5,detectUserAgent.indexOf('.',userAgentMsie)),10)}var userAgentTrident=detectUserAgent.indexOf('Trident/');if(userAgentTrident>0){var returnVersion=detectUserAgent.indexOf('rv:');return parseInt(detectUserAgent.substring(returnVersion+3,detectUserAgent.indexOf('.',returnVersion)),10)}var userAgentEdge=detectUserAgent.indexOf('Edge/');if(userAgentEdge>0){return parseInt(detectUserAgent.substring(userAgentEdge+5,detectUserAgent.indexOf('.',userAgentEdge)),10)}return false}console.log('no-ie inactive');jQuery(document).ready(function($){if($('.owl-carousel').length){var owl=$('.owl-carousel');console.log('Owl Carousel Booted');owl.owlCarousel({'loop':true,'items':1});owl.on('changed.owl.carousel',function(event){var current=event.page.index;$('.owl__buttons--jump').each(function(){if($(this).attr('data-target')==current){$(this).addClass('owl__buttons--jump__active')}else{$(this).removeClass('owl__buttons--jump__active')}})});$('.owl__buttons--jump').click(function(){owl.trigger('to.owl.carousel',[$(this).attr('data-target'),300])})}$('.filtercpt__category li').click(function(){$(this).toggleClass('filtercpt__checkbox--active')});$('.filtercpt__category label').click(function(){$(this).parent().toggleClass('filtercpt__checkbox--active')});var load_posts=function load_posts(currentPageNumber,categories){$.ajax({type:'GET',data:{numPosts:4,pageNumber:currentPageNumber,category_primary:categories},dataType:'html',url:'/wp-content/themes/JTF-child/callforpapers_ajax.php',beforeSend:function beforeSend(){},success:function success(html){console.log(html);$('.filtercpt__content').html(html);$('.filtercpt__loading').hide()},error:function error(jqXHR,textStatus,errorThrown){}})};$('.filtercpt__search--button').click(function(e){e.preventDefault();console.log('clicked');$('.filtercpt__loading').fadeIn();var $active_items=[];$('.filtercpt__checkbox').each(function(){if($(this).hasClass('filtercpt__checkbox--active')){$active_items.push($(this).find('input').attr('data-slug'))}});console.log($active_items);load_posts(1,$active_items)});$(document).on('click','.pagination__item--trigger',function(e){e.preventDefault();console.log('triggering...');$('.filtercpt__loading').fadeIn();var $active_items=[];$('.filtercpt__checkbox').each(function(){if($(this).hasClass('filtercpt__checkbox--active')){$active_items.push($(this).find('input').attr('data-slug'))}});load_posts($(this).html(),$active_items[0])});$(document).on('click','.pagination__item--max',function(e){e.preventDefault();console.log('triggering...');$('.filtercpt__loading').fadeIn();var $active_items=[];$('.filtercpt__checkbox').each(function(){if($(this).hasClass('filtercpt__checkbox--active')){$active_items.push($(this).find('input').attr('data-slug'))}});load_posts($('.filtercpt__ajax--contents').attr('data-maxpag'),$active_items[0])});$(document).on('click','.pagination__item--next',function(e){e.preventDefault();console.log('triggering...');$('.filtercpt__loading').fadeIn();var $active_items=[];$('.filtercpt__checkbox').each(function(){if($(this).hasClass('filtercpt__checkbox--active')){$active_items.push($(this).find('input').attr('data-slug'))}});load_posts(parseInt($('.filtercpt__ajax--contents').attr('data-pag'))+1,$active_items[0])});$('.filtercpt__search--clear').click(function(e){e.preventDefault();$('.filtercpt__checkbox--active').removeClass('filtercpt__checkbox--active')});$('.pills-tab a').on('click',function(e){e.preventDefault();$(this).tab('show');$(this).parents('.pillar__repeater--block').find('.pillar__tabtable--title span').text($(this).text())});$('.pillar__tabtable--menu').click(function(e){e.preventDefault();console.log('firing');$(this).toggleClass('pillar__tabtable--menu-open');$(this).parents('.pillar__repeater--block').find('.nav').toggle()});$('.pillar__download--toggle').click(function(){$(this).next().slideToggle();if($(this).children().hasClass('fa-angle-up')){console.log('D');$(this).find('.fal').removeClass('fa-angle-up')}else{console.log('U');$(this).find('.fal').addClass('fa-angle-up')}});$('.pillar__repeater--sectionnavigation-link').click(function(e){e.preventDefault();var location=$(this).data('row');$('.pillar__repeater--sectiontitle').each(function(){if($(this).data('location')==location){$('html, body').animate({scrollTop:$(this).offset().top-100+'px'},'fast')}})});if($('.pillar__repeater--sectionnavigation')!=null&&$('.pillar__repeater--sectionnavigation').length>0){var pillar_nav_offset=$('.pillar__repeater--sectionnavigation').offset().top;$(document).on('scroll',function(){if($(document).scrollTop()>=pillar_nav_offset-50){$('.pillar__repeater--sectionnavigation').addClass('pillar__navigation--sticky');$('body').addClass('pillar__locked')}else{$('.pillar__navigation--sticky').removeClass('pillar__navigation--sticky');$('.navigation__stickynav--locked').removeClass('navigation__stickynav--locked');$('body').removeClass('pillar__locked')}})}$('.pillar__repeater--sectionnavigation-trigger').click(function(e){e.preventDefault();$('.pillar__repeater--sectionnavigation-condensed').toggleClass('pillar__repeater--sectionnavigation-open');$('.pillar__navigation--sticky').toggleClass('pillar__navigation--sticky-open');if($(this).find('.fa').hasClass('fa-bars')){console.log('yes');$(this).find('.fa-bars').removeClass('fa-bars').addClass('fa-times')}else{console.log('no');$(this).find('.fa-times').removeClass('fa-times').addClass('fa-bars')}});$(window).scroll(function(){if('https://authorservices.taylorandfrancis.com/contact/'!=$(location).attr('href')){var height=$(window).scrollTop();if(height>100){$('.contactbutton__container').fadeIn('slow')}else{$('.contactbutton__container').fadeOut()}}else{$('.contactbutton__container').hide()}})});
//# sourceMappingURL=script.min.js.map
